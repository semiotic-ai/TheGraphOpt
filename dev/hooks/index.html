<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Hooks · TheGraphOpt.jl</title><script data-outdated-warner src="../assets/warner.js"></script><link rel="canonical" href="https://semiotic-ai.github.io/TheGraphOpt.jl/hooks/"/><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.045/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.13.24/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL=".."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../assets/documenter.js"></script><script src="../siteinfo.js"></script><script src="../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><div class="docs-package-name"><span class="docs-autofit"><a href="../">TheGraphOpt.jl</a></span></div><form class="docs-search" action="../search/"><input class="docs-search-query" id="documenter-search-query" name="q" type="text" placeholder="Search docs"/></form><ul class="docs-menu"><li><a class="tocitem" href="../">Home</a></li><li><a class="tocitem" href="../algorithms/">Algorithms</a></li><li class="is-active"><a class="tocitem" href>Hooks</a><ul class="internal"><li><a class="tocitem" href="#Traits"><span>Traits</span></a></li><li><a class="tocitem" href="#Using-Predefined-Hooks"><span>Using Predefined Hooks</span></a></li><li><a class="tocitem" href="#Create-Custom-Hooks"><span>Create Custom Hooks</span></a></li></ul></li><li><a class="tocitem" href="../api/">API</a></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><nav class="breadcrumb"><ul class="is-hidden-mobile"><li class="is-active"><a href>Hooks</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Hooks</a></li></ul></nav><div class="docs-right"><a class="docs-edit-link" href="https://github.com/semiotic-ai/TheGraphOpt.jl/blob/main/docs/src/hooks.md#" title="Edit on GitHub"><span class="docs-icon fab"></span><span class="docs-label is-hidden-touch">Edit on GitHub</span></a><a class="docs-settings-button fas fa-cog" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-sidebar-button fa fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a></div></header><article class="content" id="documenter-page"><h1 id="hooks"><a class="docs-heading-anchor" href="#hooks">Hooks</a><a id="hooks-1"></a><a class="docs-heading-anchor-permalink" href="#hooks" title="Permalink"></a></h1><p>Hooks enable you to dynamically choose to inject functionality into algorithms. Some hooks are mandatory for certain algorithms, such as having a hook with the <a href="#TheGraphOpt.IsStoppingCondition"><code>TheGraphOpt.IsStoppingCondition</code></a> trait when using <a href="../algorithms/#TheGraphOpt.GradientDescent"><code>TheGraphOpt.GradientDescent</code></a>. Others are purely there for you to use at your discretion. In this section, we&#39;ll take you through <a href="#Traits">Traits</a>, <a href="#Using-Predefined-Hooks">Using Predefined Hooks</a> and how to <a href="#Create-Custom-Hooks">Create Custom Hooks</a>.</p><h2 id="Traits"><a class="docs-heading-anchor" href="#Traits">Traits</a><a id="Traits-1"></a><a class="docs-heading-anchor-permalink" href="#Traits" title="Permalink"></a></h2><p>Hooks have traits. This is how our code knows when to execute which hook. For example, the code will execute a hook that has the <a href="#TheGraphOpt.IsStoppingCondition"><code>TheGraphOpt.IsStoppingCondition</code></a> trait when evaluating whether it has finished optimising. A full list of traits follows.</p><h3 id="StopTrait"><a class="docs-heading-anchor" href="#StopTrait">StopTrait</a><a id="StopTrait-1"></a><a class="docs-heading-anchor-permalink" href="#StopTrait" title="Permalink"></a></h3><p>This trait tells the code if it should execute a hook when checking stopping conditions. By default, the code automatically gives all hooks the <a href="#TheGraphOpt.IsNotStoppingCondition"><code>TheGraphOpt.IsNotStoppingCondition</code></a> trait except in certain situations, which are explicitly documented with the hooks in question. We decide to stop code execution on an <code>OR</code> basis. This means that if <em>any</em> hook with <a href="#TheGraphOpt.IsStoppingCondition"><code>TheGraphOpt.IsStoppingCondition</code></a> returns <code>true</code>, the code breaks out of the optimisation loop. Hooks with this trait must implement <a href="#TheGraphOpt.stophook"><code>TheGraphOpt.stophook</code></a>.</p><article class="docstring"><header><a class="docstring-binding" id="TheGraphOpt.StopTrait" href="#TheGraphOpt.StopTrait"><code>TheGraphOpt.StopTrait</code></a> — <span class="docstring-category">Type</span></header><section><div><p>Abstract type for stopping conditions traits</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/semiotic-ai/TheGraphOpt.jl/blob/8d6b5e3e457df4516d983a2e1a245a53aacaa5c4/src/trait.jl#L8-L10">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="TheGraphOpt.IsStoppingCondition" href="#TheGraphOpt.IsStoppingCondition"><code>TheGraphOpt.IsStoppingCondition</code></a> — <span class="docstring-category">Type</span></header><section><div><p>Exhibited by hooks that are stopping conditions. Stopping condition hooks must emit a boolean value when <a href="#TheGraphOpt.stophook"><code>TheGraphOpt.stophook</code></a> is called. If multiple hooks meet <code>IsStoppingCondition</code> are instantiated at the same time, we assume that they are meant to be OR&#39;ed, so if any of them is true, optimisation is finished. For more complex behaviour, consider defining a more complex function using a single <a href="#TheGraphOpt.StopWhen"><code>StopWhen</code></a>.</p><p>To set this trait for a hook, run</p><pre><code class="language-julia hljs">julia&gt; StopTrait(::Type{MyHook}) = IsStoppingCondition()</code></pre></div><a class="docs-sourcelink" target="_blank" href="https://github.com/semiotic-ai/TheGraphOpt.jl/blob/8d6b5e3e457df4516d983a2e1a245a53aacaa5c4/src/trait.jl#L13-L25">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="TheGraphOpt.IsNotStoppingCondition" href="#TheGraphOpt.IsNotStoppingCondition"><code>TheGraphOpt.IsNotStoppingCondition</code></a> — <span class="docstring-category">Type</span></header><section><div><p>Exhibited by hooks that are not stopping conditions. This is the default case. You should not have to set it manually for any hooks.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/semiotic-ai/TheGraphOpt.jl/blob/8d6b5e3e457df4516d983a2e1a245a53aacaa5c4/src/trait.jl#L28-L32">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="TheGraphOpt.stophook" href="#TheGraphOpt.stophook"><code>TheGraphOpt.stophook</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia hljs">stophook(h::::IsStoppingCondition, a::OptAlgorithm; locals...)</code></pre><p>Raise an error if the hook is a stopping condition but has not implemented <code>stophook</code>.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/semiotic-ai/TheGraphOpt.jl/blob/8d6b5e3e457df4516d983a2e1a245a53aacaa5c4/src/hook.jl#L26-L30">source</a></section><section><div><pre><code class="nohighlight hljs">stophook(h::::(!IsStoppingCondition), a::OptAlgorithm; locals...)</code></pre><p>If the hook isn&#39;t a stopping condition, it shouldn&#39;t be considered in the OR, so return false.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/semiotic-ai/TheGraphOpt.jl/blob/8d6b5e3e457df4516d983a2e1a245a53aacaa5c4/src/hook.jl#L37-L41">source</a></section><section><div><pre><code class="nohighlight hljs">stophook(h::StopWhen, a::OptAlgorithm; locals...)</code></pre><p>Call <code>h.f</code> on <code>a</code> and <code>;locals</code>.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/semiotic-ai/TheGraphOpt.jl/blob/8d6b5e3e457df4516d983a2e1a245a53aacaa5c4/src/hook.jl#L59-L63">source</a></section></article><h2 id="Using-Predefined-Hooks"><a class="docs-heading-anchor" href="#Using-Predefined-Hooks">Using Predefined Hooks</a><a id="Using-Predefined-Hooks-1"></a><a class="docs-heading-anchor-permalink" href="#Using-Predefined-Hooks" title="Permalink"></a></h2><p>Hooks always descend from the same abstract type.</p><article class="docstring"><header><a class="docstring-binding" id="TheGraphOpt.Hook" href="#TheGraphOpt.Hook"><code>TheGraphOpt.Hook</code></a> — <span class="docstring-category">Type</span></header><section><div><p>Abstract type for hooks.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/semiotic-ai/TheGraphOpt.jl/blob/8d6b5e3e457df4516d983a2e1a245a53aacaa5c4/src/hook.jl#L6-L8">source</a></section></article><p>Generally speaking, pre-defined hooks won&#39;t exhibit any positive traits unless explicitly documented otherwise. This serves two purposes. Firstly, it prevents any unexpected behaviour when the code executes. Secondly, it gives you more flexibility when choosing where you want a hook to be executed.</p><div class="admonition is-warning"><header class="admonition-header">Warning</header><div class="admonition-body"><p>This section is incomplete! We will fill this out more once we have more traits and hooks to work with.</p></div></div><div class="admonition is-info"><header class="admonition-header">Note</header><div class="admonition-body"><p>We recommend you read the below <a href="#StopWhen">StopWhen</a> section as it explains details that we won&#39;t cover in the later sections since it&#39;d be too repetitive.</p></div></div><h3 id="StopWhen"><a class="docs-heading-anchor" href="#StopWhen">StopWhen</a><a id="StopWhen-1"></a><a class="docs-heading-anchor-permalink" href="#StopWhen" title="Permalink"></a></h3><p>This hook has the <a href="#TheGraphOpt.IsStoppingCondition"><code>TheGraphOpt.IsStoppingCondition</code></a> trait. To use it, you would specify a function that returns a boolean value. If said value is <code>true</code>, then the code breaks out of the optimisation loop.</p><p>Let&#39;s take an example from our tests to demonstrate how to specify this hook. We&#39;ll also implement a dummy optimisation function that just implements a counter for illustration purposes.</p><pre><code class="language-julia hljs">julia&gt; using TheGraphOpt
julia&gt; struct FakeOptAlg &lt;: TheGraphOpt.OptAlgorithm end
juila&gt; a = FakeOptAlg()
julia&gt; function counter(h, a)
            i = 0
            while !shouldstop(h, a; Base.@locals()...)
                i += 1
            end
            return i
        end
julia&gt; h = StopWhen((a; locals...) -&gt; locals[:i] ≥ 5, Dict())  # Stop when i ≥ 5
julia&gt; i = counter((h,), a)
5</code></pre><p>One thing you may not have seen is <code>Base.@locals</code>. This takes variables from the local scope (in this case, from the <code>counter</code> scope), and tracks them as a dictionary of symbols. Thus, since <code>i</code> is a local variable inside of <code>counter</code>, <code>:i</code> becomes a key in the <code>Base.@locals</code> dictionary. We pass this dictionary to the anonymouse function stored by <code>StopWhen</code>. Then, we can use <code>locals[:i]</code> to get the value of <code>i</code> from the <code>counter</code> scope and check it against some condition. This is a powerful trick you may find yourself using a lot when dealing with hooks.</p><article class="docstring"><header><a class="docstring-binding" id="TheGraphOpt.StopWhen" href="#TheGraphOpt.StopWhen"><code>TheGraphOpt.StopWhen</code></a> — <span class="docstring-category">Type</span></header><section><div><pre><code class="language-julia hljs">StopWhen(f::Function)</code></pre><p>Stops optimisation when some condition is met.</p><p>The condition is set by <code>f</code>. Note that <code>f</code> gets access to variables in the <a href="../algorithms/#TheGraphOpt.minimize"><code>TheGraphOpt.minimize</code></a> scope. This means, for example, that it can use <code>locals[:z]</code> to compute residuals. This has the <a href="#TheGraphOpt.IsStoppingCondition"><code>TheGraphOpt.IsStoppingCondition</code></a> trait.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/semiotic-ai/TheGraphOpt.jl/blob/8d6b5e3e457df4516d983a2e1a245a53aacaa5c4/src/hook.jl#L44-L53">source</a></section></article><h2 id="Create-Custom-Hooks"><a class="docs-heading-anchor" href="#Create-Custom-Hooks">Create Custom Hooks</a><a id="Create-Custom-Hooks-1"></a><a class="docs-heading-anchor-permalink" href="#Create-Custom-Hooks" title="Permalink"></a></h2><p>When you create a custom hook, you need to follow three steps. The first is that you need to descend from <a href="#TheGraphOpt.Hook"><code>TheGraphOpt.Hook</code></a>.</p><pre><code class="language-julia hljs">julia&gt; using TheGraphOpt
julia&gt; struct MyHook &lt;: Hook end</code></pre><p>The second is that you need to ensure that you specify which traits you want that hook to exhibit. For example, let&#39;s say <code>MyHook</code> is a stopping condition. You&#39;d want to implement.</p><pre><code class="language-julia hljs">julia&gt; StopTrait(::Type{MyHook}) = IsStoppingCondition()</code></pre><p>Finally, if you need non-default behaviour for when the hook executes, you&#39;ll need to implement whatever function(s) the code calls for that trait-type. For <code>IsStoppingCondition</code>, that&#39;s <code>stophook</code>. Say we want <code>MyHook</code> to immediately cause optimisation to finish. We&#39;d implement</p><pre><code class="language-julia hljs">julia&gt; stophook(h::MyHook, a::TheGraphOpt.OptAlgorithm; locals...) = true</code></pre><p>That&#39;s it! As long as your follow those three steps, you should be able to implement whatever hook you want!</p></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../algorithms/">« Algorithms</a><a class="docs-footer-nextpage" href="../api/">API »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 0.27.23 on <span class="colophon-date" title="Thursday 13 October 2022 19:46">Thursday 13 October 2022</span>. Using Julia version 1.8.2.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
